From 7c615e9ae199bfbf52da20ca4421045f00080dc7 Mon Sep 17 00:00:00 2001
From: Pavel Odintsov <pavel.odintsov@gmail.com>
Date: Tue, 25 Jul 2017 19:53:15 +0100
Subject: [PATCH] Removed code which uses x86_only features to fix
 https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=869621

---
 src/fast_library.cpp | 23 -----------------------
 src/fast_library.h   |  3 ---
 2 files changed, 26 deletions(-)

diff --git a/src/fast_library.cpp b/src/fast_library.cpp
index 21f8723..ead737d 100644
--- a/src/fast_library.cpp
+++ b/src/fast_library.cpp
@@ -1008,29 +1008,6 @@ bool call_lua_function(std::string function_name, lua_State* lua_state_param, st
 
 #endif
 
-inline uint64_t read_tsc_cpu_register() {
-    union {
-        uint64_t tsc_64;
-            struct {
-                uint32_t lo_32;
-                uint32_t hi_32;
-            };  
-    } tsc;
-
-    asm volatile("rdtsc" :
-        "=a" (tsc.lo_32),
-        "=d" (tsc.hi_32));
-    return tsc.tsc_64;
-}
-
-uint64_t get_tsc_freq_with_sleep() {
-    uint64_t start = read_tsc_cpu_register();
-            
-    sleep(1);
-
-    return read_tsc_cpu_register() - start;
-}
-
 json_object* serialize_attack_description_to_json(attack_details& current_attack) {
     json_object* jobj = json_object_new_object();
 
diff --git a/src/fast_library.h b/src/fast_library.h
index 3e04a62..5d88d62 100644
--- a/src/fast_library.h
+++ b/src/fast_library.h
@@ -104,9 +104,6 @@ subnet_t convert_subnet_from_string_to_binary(std::string subnet_cidr);
 std::vector <std::string> split_strings_to_vector_by_comma(std::string raw_string);
 subnet_t convert_subnet_from_string_to_binary_with_cidr_format(std::string subnet_cidr);
 
-inline uint64_t read_tsc_cpu_register();
-uint64_t get_tsc_freq_with_sleep();
-
 #ifdef __linux__
 bool manage_interface_promisc_mode(std::string interface_name, bool switch_on);
 #endif
-- 
2.11.0

